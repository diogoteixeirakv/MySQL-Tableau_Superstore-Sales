-- ~ TRENDING THE DATA ~ --
-- A) Simple Trends: to "Technology" category.
-- B) Comparing Trends: to "Technology" and "Furniture" categories.




-- A) SIMPLE TRENDS
-- to "Technology" category.

-- by day
SELECT orderdate, sales
FROM superstore
WHERE category="technology"
ORDER BY 1

-- by month
SELECT date_format(orderdate,'%y-%m') as month_date, round(sum(sales)) as sales 
FROM superstore
WHERE category = 'technology'
GROUP BY 1
ORDER BY 1

--  by year
SELECT year(orderdate) as year_date, round(sum(sales)) as sales 
FROM superstore
WHERE category = 'technology'
GROUP BY 1
ORDER BY 1


-- Index to see the Percent Change over Time --

-- Step 1)
SELECT year_date, round(sales) as sales, 
		round(first_value(sales) over (ORDER BY sales)) as index_sales
FROM
(
	SELECT year(orderdate) as year_date, sum(sales) as sales
	FROM superstore
	WHERE category = 'technology'
	GROUP BY 1
    ORDER BY 1
) a

-- Step 2)
SELECT year_date, round(sales) as sales
	, round((sales / first_value(sales) over (ORDER BY year_date) - 1) * 100, 2)
	as pct_FROM_index
FROM
(
	SELECT year(orderdate) as year_date, 
			sum(sales) as sales
	FROM superstore
	WHERE category = 'technology'
	GROUP BY 1
) a

-- Step 3)
SELECT year_date, category, round(sales) as sales
	,round((sales / first_value(sales) over (partition by category ORDER BY year_date)- 1) * 100, 2) as pct_FROM_index
FROM
(
	SELECT year(orderdate) as year_date, category, sum(sales) as sales
	FROM superstore
	WHERE category in ('technology'	,'furniture')
	GROUP BY 1,2
    ORDER BY 1
) a




-- B) COMPARING TRENDS
-- to "Technology" and "Furniture" categories.


-- Period-over-Period Comparisons: Year-over-year (YoY) and month-over-month (MoM)
-- Letâ€™s compare the Yearly and Monthly sales trend for the following categories: Technology, Furniture, and Office supplies.

-- a) YoY
SELECT year(orderdate) as year, category, round(sum(sales)) as sales 
FROM superstore
WHERE category in ('technology','furniture','office supplies')
GROUP BY 1,2
ORDER BY 1,2

-- b) MoM (ranking by No. of Sales) 
SELECT date_format(orderdate,'%y-%m') as month_date, category, round(sum(sales)) as sales
    ,dense_rank() OVER (PARTITION BY date_format(orderdate,'%Y-%b') ORDER BY round(sum(sales)) DESC) AS dense_rank_num
FROM superstore
GROUP BY 1,2
ORDER BY 1,3 desc


-- Calculate the GAP between the two categories: Technology and Furniture

-- Step 1) Pivot
SELECT year(orderdate) as sales_year
		,sum(case when category = 'technology' then round(sales) end) as technology_sales
		,sum(case when category = 'furniture' then round(sales) end) as furniture_sales
FROM superstore
WHERE category in ('technology', 'furniture')
GROUP BY 1
ORDER BY 1

-- Step 2) Subtract
SELECT sales_year
		,technology_sales
        ,furniture_sales
		,technology_sales - furniture_sales as tech_minus_furniture
		,furniture_sales - technology_sales as furniture_minus_tech 
FROM
(
	SELECT year(orderdate) as sales_year
			,sum(case when category = 'technology' then round(sales) end) as technology_sales
			,sum(case when category = 'furniture' then round(sales)	end) as furniture_sales
	FROM superstore
	WHERE category in ('technology', 'furniture')
	GROUP BY 1
    ORDER BY 1
) a


-- Calculate the Ratio between the two categories: Technology and Furniture

SELECT sales_year
		,round(technology_sales / furniture_sales, 2) as tech_times_of_furniture
FROM
(
	SELECT year(orderdate) as sales_year
			,sum(case when category = 'technology' then round(sales) end) as technology_sales
			,sum(case when category = 'furniture' then round(sales)	end) as furniture_sales
	FROM superstore
	WHERE category in ('technology', 'furniture')
	GROUP BY 1
    ORDER BY 1
) a


-- Calculate the Percente difference between the two categories: Technology and Furniture

SELECT sales_year
		,round( (technology_sales / furniture_sales -1)*100, 2) as tech_pct_of_furniture
FROM
(
	SELECT year(orderdate) as sales_year, sum(case when category = 'technology' then round(sales) end) as technology_sales
			,sum(case when category = 'furniture' then round(sales)	end) as furniture_sales
	FROM superstore
	WHERE category in ('technology', 'furniture')
	GROUP BY 1
) a
